package i

import (
	_fmt "fmt"
	"reflect"
	"testing"
)

func TestP(t *testing.T) {
	testCases := []struct {
		s s
		r v
	}{
		{"", nil},
		{"1", 1.0},
		{"1 2 3", fv{1, 2, 3}},
		{"1.2 3a90", zv{c(1.2, 0), c(0, 3)}},
		{" -1  3a180 0i2 ", zv{c(-1, 0), c(-3, 0), c(0, 2)}},
		{"`a", l{"`", "a"}},
		{"`", l{"`", ""}},
		{"`a`b", sv{"a", "b"}},
		{"`a_1 `bZ3`\"+-,:\"", sv{"a_1", "bZ3", "+-,:"}},
		{`"x"`, 'x'},
		{`""`, rv{}},
		{`"xy"`, rv{'x', 'y'}},
		{`"x\ny"`, rv{'x', '\n', 'y'}},
		{`[a:1;beta:2 3]`, l{"!", l{"a", "beta"}, l{1.0, fv{2, 3}}}},
		{"x", "x"},
		{"x_3", "x_3"},
		{"x_3:1 2i3", l{":", "x_3", zv{1, c(2, 3)}}},
	}
	for _, tc := range testCases {
		r := P(tc.s)
		_fmt.Printf("prs: %q %+v\n", tc.s, r) // TODO: change to printf
		if reflect.DeepEqual(r, tc.r) == false {
			_fmt.Printf("exp: %+v\n", tc.r) // TODO: change to printf
			_fmt.Printf("got: %+v\n", r)    // TODO: change to printf
			t.Fatal()
		}
	}
}

func TestScan(t *testing.T) {
	type iv [11]i //0     1     2     3     4     5     6     7     8     9    10
	var f = [11]sf{sNum, sNam, sSym, sStr, sVrb, sAsn, sIov, sAdv, sViw, sDct, sWsp}
	var testCases = []struct {
		s s
		r iv
	}{
		{` `, iv{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1}},
		{`0`, iv{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{`23`, iv{2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{`+1`, iv{2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0}}, // +1 is a number
		{`-1`, iv{2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0}},
		{`1e`, iv{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{`1.`, iv{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{`.5`, iv{0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0}},  // no number: .5 use 0.5
		{`1i`, iv{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},  // no number: 1i
		{`0i1`, iv{3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}}, // complex i: 0i1
		{`-1i0`, iv{4, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0}},
		{`i`, iv{0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{`-i`, iv{0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0}},
		{`1.23e+06i-1.23e-13`, iv{18, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{`13.275a275.2`, iv{12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{`π`, iv{0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0}}, // name!
		{`a`, iv{0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{`a2`, iv{0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{`a2/`, iv{0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{"`a", iv{0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0}},
		{"`a3", iv{0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0}},
		{"`a3.", iv{0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0}},
		{`"a"`, iv{0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0}},
		{"`a_3", iv{0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0}},
		{"`\"+-*\"xyz", iv{0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0}},
		{`"a"b`, iv{0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0}},
		{`"x\ny"`, iv{0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0}},
		{`"a\"b\n"b`, iv{0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0}},
		{`+`, iv{0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0}},
		{`⍟3`, iv{0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0}},
		{`⍟:`, iv{0, 0, 0, 0, 1, 2, 0, 0, 0, 0, 0}},
		{`+:`, iv{0, 0, 0, 0, 1, 2, 0, 0, 0, 0, 0}},
		{`1:`, iv{1, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0}},
		{`/`, iv{0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0}},
		{`':`, iv{0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0}},
		{`⍨`, iv{0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0}},
		{`::x`, iv{0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0}},
		{`[`, iv{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{`[:`, iv{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{`[3:`, iv{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{`[a:`, iv{0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0}},
		{`[a3:`, iv{0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 0}},
		{`[ab3:`, iv{0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 0}},
		{`  \n `, iv{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2}},
		{"  \t\r ", iv{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5}},
	}
	for _, tc := range testCases {
		for k, f := range f {
			if n := f([]rune(tc.s)); n != tc.r[k] {
				t.Fatalf("%q: f[%d] got %d, exp %d", tc.s, k, n, tc.r[k])
			}
		}
	}
}
