#include<stdlib.h>
#include<stdio.h>
#include<stddef.h>
#include<malloc.h>
#include<string.h>
#include<math.h>
#define R return
typedef void V;typedef char C;typedef int32_t I;typedef int64_t J;typedef double F;typedef uint32_t uI;typedef uint64_t uJ;
I __builtin_clz(I x){I r;__asm__("bsr %1, %0" : "=r" (r) : "rm" (x) : "cc");R r^31;}
V trap() { exit(1); }
C *MC;I* MI;J* MJ;F *MF;
//F NaN = &((unt64_t)9221120237041090561ull);
V *MT[6];
I ini(I);I bk(I,I);I mk(I,I);I mki(I);I mkf(F);I mkd(I,I);I mkz(I,I);V fr(I);V dx(I);V rx(I);V rl(I);I til(I);I seq(I,I,I);I tir(I);I atx(I,I);I rev(I);I fst(I);I cut(I,I);I drop(I,I);I rsh(I,I);I prod(I,I);I take(I,I);V mv(I,I,I);I cat(I,I);I ucat(I,I);I lcat(I,I);I enl(I);I cnt(I);I tip(I);I wer(I);I not(I);I eql(I,I);I mtc(I,I);I match(I,I);I fnd(I,I);I fnx(I,I);I fnc(I,I,I);I fni(I,I,I);I fnj(I,I,J);I fnl(I,I,I);I exc(I,I);I up(I,I);I srt(I);I gdn(I);I grd(I);V msrt(I,I,I,I,I,I);V mrge(I,I,I,I,I,I,I);I gtc(I,I);I gti(I,I);I gtf(I,I);I gtl(I,I);
I ini(I x0){I x1=0;I x2=0;MJ[0>>3]=(J)289360691419414784;MI[128>>2]=(I)x0;x1=256;x2=8;while(((uI)x2<(uI)x0)){MI[(4*x2)>>2]=(I)x1;x1=(x1*2);x2=(x2+1);}R x0;}
I bk(I x0,I x1){I x2=0;x2=(32-(__builtin_clz((7+((x1*((I)MC[x0])))))));if(((uI)x2<(uI)4)){R 4;}R x2;}
I mk(I x0,I x1){I x2=0;I x3=0;I x4=0;I x5=0;I x6=0;x2=bk(x0,x1);x3=(4*x2);while(!(MI[x3>>2])){x3=(x3+4);}if((128==x3)){trap();}x4=MI[x3>>2];MI[x3>>2]=(I)MI[x4>>2];x5=(x3-4);while(((uI)x5>=(uI)((4*x2)))){x6=(x4+((1<<(((uI)x5>>(uI)2)))));MI[x6>>2]=(I)MI[x5>>2];MI[x5>>2]=(I)x6;x5=(x5-4);}MI[x4>>2]=(I)(x1|((x0<<29)));MI[(x4+4)>>2]=(I)1;R x4;}
I mki(I x0){I x1=0;x1=mk(2,1);MI[(x1+8)>>2]=(I)x0;R x1;}
I mkf(F x0){I x1=0;x1=mk(3,1);MF[(x1+8)>>3]=(F)x0;R x1;}
I mkd(I x0,I x1){I x2=0;I x3=0;I x4=0;I x5=0;I x6=0;I x7=0;I x8=0;x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);x5=((uI)(MI[x1>>2])>>(uI)29);x6=((MI[x1>>2])&536870911);x7=(8+x1);if(!((x2==x5))){trap();}if((((x3==1))&(((uI)x6>(uI)1)))){x0=take(x0,x6);x3=x6;x4=(x0+8);}if((((x6==1))&(((uI)x3>(uI)1)))){x1=take(x1,x3);x6=x3;x7=(x1+8);}if(!((x3==x6))){trap();}x8=mk(7,2);MI[(x8+8)>>2]=(I)x0;MI[(x8+12)>>2]=(I)x1;R x8;}
I mkz(I x0,I x1){I x2=0;x2=mkd(x0,x1);MI[x2>>2]=(I)(2|((6<<29)));R x2;}
V fr(I x0){I x1=0;I x2=0;I x3=0;I x4=0;x1=((uI)(MI[x0>>2])>>(uI)29);x2=((MI[x0>>2])&536870911);x3=(8+x0);x4=(4*(bk(x1,x2)));MI[x0>>2]=(I)MI[x4>>2];MI[x4>>2]=(I)x0;;}
V dx(I x0){I x1=0;I x2=0;I x3=0;I x4=0;I x5=0;if(((uI)x0>(uI)255)){x1=MI[(x0+4)>>2];MI[(x0+4)>>2]=(I)(x1-1);if((1==x1)){x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);if(((uI)x2>(uI)3)){for(x5=0;x5<x3;x5++){dx(MI[(x4+((4*x5)))>>2]);}}fr(x0);}};}
V rx(I x0){if(((uI)x0>(uI)255)){x0=(x0+4);MI[x0>>2]=(I)(1+(MI[x0>>2]));};}
V rl(I x0){I x1=0;I x2=0;I x3=0;I x4=0;x1=((uI)(MI[x0>>2])>>(uI)29);x2=((MI[x0>>2])&536870911);x3=(8+x0);for(x4=0;x4<x2;x4++){rx(MI[x3>>2]);x3=(x3+4);};}
I til(I x0){I x1=0;I x2=0;I x3=0;I x4=0;x1=((uI)(MI[x0>>2])>>(uI)29);x2=((MI[x0>>2])&536870911);x3=(8+x0);if(!((2==x1))){trap();}x4=MI[x3>>2];dx(x0);if((x4<0)){R tir(-x4);}R seq(0,x4,1);}
I seq(I x0,I x1,I x2){I x3=0;I x4=0;I x5=0;x3=mk(2,x1);x4=(8+x3);for(x5=0;x5<x1;x5++){MI[x4>>2]=(I)(x2*((x5+x0)));x4=(x4+4);}R x3;}
I tir(I x0){I x1=0;I x2=0;I x3=0;x1=mk(2,x0);x2=(4+((x1+((4*x0)))));for(x3=0;x3<x0;x3++){MI[x2>>2]=(I)x3;x2=(x2-4);}R x1;}
I atx(I x0,I x1){I x2=0;I x3=0;I x4=0;I x5=0;I x6=0;I x7=0;I x8=0;I x9=0;I x10=0;I x11=0;I x12=0;x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);x5=((uI)(MI[x1>>2])>>(uI)29);x6=((MI[x1>>2])&536870911);x7=(8+x1);if(!((x5==2))){trap();}x8=mk(x2,x6);x9=(x8+8);switch(x2){case 0:trap();break;case 1:for(x12=0;x12<x6;x12++){MC[(x9+x12)]=(C)(C)32;x10=MI[x7>>2];if(((uI)x10<(uI)x3)){MC[(x9+x12)]=(C)MC[(x4+x10)];}x7=(x7+4);}break;case 2:for(x12=0;x12<x6;x12++){MI[x9>>2]=(I)-2147483648;x10=MI[x7>>2];if(((uI)x10<(uI)x3)){MI[x9>>2]=(I)MI[(x4+((4*x10)))>>2];}x9=(x9+4);x7=(x7+4);}break;case 3:for(x12=0;x12<x6;x12++){MF[x9>>3]=(F)NAN;x10=MI[x7>>2];if(((uI)x10<(uI)x3)){MF[x9>>3]=(F)MF[(x4+((8*x10)))>>3];}x9=(x9+8);x7=(x7+4);}break;case 4:x11=mk(1,0);for(x12=0;x12<x6;x12++){MI[x9>>2]=(I)x11;x10=MI[x7>>2];if(((uI)x10<(uI)x3)){MI[x9>>2]=(I)MI[(x4+((4*x10)))>>2];}x9=(x9+4);x7=(x7+4);}rl(x8);dx(x11);break;case 5:x11=mk(1,0);for(x12=0;x12<x6;x12++){MI[x9>>2]=(I)x11;x10=MI[x7>>2];if(((uI)x10<(uI)x3)){MI[x9>>2]=(I)MI[(x4+((4*x10)))>>2];}x9=(x9+4);x7=(x7+4);}rl(x8);dx(x11);break;default:trap();}dx(x0);dx(x1);R x8;}
I rev(I x0){I x1=0;I x2=0;I x3=0;x1=((uI)(MI[x0>>2])>>(uI)29);x2=((MI[x0>>2])&536870911);x3=(8+x0);if(!x2){R x0;}R atx(x0,tir(x2));}
I fst(I x0){I x1=0;I x2=0;I x3=0;x1=((uI)(MI[x0>>2])>>(uI)29);x2=((MI[x0>>2])&536870911);x3=(8+x0);if((x1==7)){rx((12+x0));dx(x0);R fst((12+x0));}R atx(x0,mki(0));}
I cut(I x0,I x1){I x2=0;I x3=0;I x4=0;I x5=0;I x6=0;I x7=0;I x8=0;I x9=0;I x10=0;I x11=0;I x12=0;x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);x5=((uI)(MI[x1>>2])>>(uI)29);x6=((MI[x1>>2])&536870911);x7=(8+x1);if(!((x2==2))){trap();}if((x3==1)){x8=drop(x1,MI[x4>>2]);dx(x0);R x8;}x8=mk(5,x3);x9=(x8+8);for(x12=0;x12<x3;x12++){x10=MI[x4>>2];x11=MI[(x4+4)>>2];if((x12==((x3-1)))){x11=x6;}if(((uI)x11<(uI)x10)){trap();}rx(x1);MI[x9>>2]=(I)atx(x1,seq(x10,(x11-x10),1));x4=(x4+4);x9=(x9+4);}dx(x0);dx(x1);R x8;}
I drop(I x0,I x1){I x2=0;I x3=0;I x4=0;x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);if(((uI)x1>(uI)x3)){trap();}R atx(x0,seq(x1,(x3-x1),1));}
I rsh(I x0,I x1){I x2=0;I x3=0;I x4=0;I x5=0;I x6=0;I x7=0;I x8=0;I x9=0;I x10=0;I x11=0;I x12=0;x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);x5=((uI)(MI[x1>>2])>>(uI)29);x6=((MI[x1>>2])&536870911);x7=(8+x1);if(!((x2==2))){trap();}x8=prod(x4,x3);x9=take(x1,x8);if((x3==1)){dx(x0);R x9;}x3=(x3-1);x10=(x4+((4*x3)));for(x12=0;x12<x3;x12++){x11=MI[x10>>2];x8=((uI)x8/(uI)x11);x8=prod(x4,(x3-x12));x9=cut(seq(0,x8,x11),x9);x10=(x10-4);}dx(x0);R x9;}
I prod(I x0,I x1){I x2=0;I x3=0;x2=1;for(x3=0;x3<x1;x3++){x2=(x2*(MI[x0>>2]));x0=(x0+4);}R x2;}
I take(I x0,I x1){I x2=0;I x3=0;I x4=0;I x5=0;I x6=0;I x7=0;x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);x5=til(mki(x1));x6=(x5+8);if(((uI)x3<(uI)x1)){for(x7=0;x7<x1;x7++){MI[(x6+((4*x7)))>>2]=(I)((uI)x7%(uI)x3);}}R atx(x0,x5);}
V mv(I x0,I x1,I x2){I x3=0;for(x3=0;x3<x2;x3++){MC[(x0+x3)]=(C)MC[(x1+x3)];};}
I cat(I x0,I x1){I x2=0;I x3=0;I x4=0;I x5=0;I x6=0;I x7=0;x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);x5=((uI)(MI[x1>>2])>>(uI)29);x6=((MI[x1>>2])&536870911);x7=(8+x1);if(((!x2)|(!x5))){trap();}if((x2==x5)){R ucat(x0,x1);}if((x2==5)){R lcat(x0,x1);}trap();R x0;}
I ucat(I x0,I x1){I x2=0;I x3=0;I x4=0;I x5=0;I x6=0;I x7=0;I x8=0;I x9=0;x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);x5=((uI)(MI[x1>>2])>>(uI)29);x6=((MI[x1>>2])&536870911);x7=(8+x1);if(((uI)x2>(uI)4)){rl(x0);}if(((uI)x2>(uI)5)){x8=mkd((x0+8),(x0+12));dx(x0);dx(x1);R x8;}x8=mk(x2,(x3+x6));x9=(I)MC[x2];mv((x8+8),x4,(x9*x3));mv((x8+((8+((x9*x3))))),x7,(x9*x6));dx(x0);dx(x1);R x8;}
I lcat(I x0,I x1){I x2=0;I x3=0;I x4=0;I x5=0;x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);if(((uI)(bk(x2,x3))<(uI)(bk(x2,(x3+1))))){x5=mk(x2,(x3+1));mv((x5+8),x4,(4*x3));dx(x0);x0=x5;x4=(x0+8);}MI[(x4+((4*x3)))>>2]=(I)x1;MI[x0>>2]=(I)(((x3+1))|((5<<29)));R x0;}
I enl(I x0){R lcat(mk(5,0),x0);}
I cnt(I x0){I x1=0;I x2=0;I x3=0;x1=((uI)(MI[x0>>2])>>(uI)29);x2=((MI[x0>>2])&536870911);x3=(8+x0);dx(x0);R mki(x2);}
I tip(I x0){I x1=0;I x2=0;I x3=0;I x4=0;x1=((uI)(MI[x0>>2])>>(uI)29);x2=((MI[x0>>2])&536870911);x3=(8+x0);x4=mk(2,1);MI[(8+x4)>>2]=(I)x1;dx(x0);R x4;}
I wer(I x0){I x1=0;I x2=0;I x3=0;I x4=0;I x5=0;I x6=0;I x7=0;I x8=0;I x9=0;x1=((uI)(MI[x0>>2])>>(uI)29);x2=((MI[x0>>2])&536870911);x3=(8+x0);if(!((x1==2))){trap();}x4=0;for(x7=0;x7<x2;x7++){x4=(x4+(MI[x3>>2]));x3=(x3+4);}x3=(8+x0);x5=mk(2,x4);x6=(x5+8);for(x7=0;x7<x2;x7++){x8=MI[x3>>2];for(x9=0;x9<x8;x9++){MI[x6>>2]=(I)x7;x6=(x6+4);}x3=(x3+4);}dx(x0);R x5;}
I not(I x0){R eql(x0,mki(0));}
I eql(I x0,I x1){I x2=0;I x3=0;I x4=0;I x5=0;I x6=0;I x7=0;I x8=0;I x9=0;I x10=0;x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);x5=((uI)(MI[x1>>2])>>(uI)29);x6=((MI[x1>>2])&536870911);x7=(8+x1);if(!((x2==x5))){trap();}if((((x3==1))&(((uI)x6>(uI)1)))){x0=take(x0,x6);x3=x6;x4=(x0+8);}if((((x6==1))&(((uI)x3>(uI)1)))){x1=take(x1,x3);x6=x3;x7=(x1+8);}if(!((x3==x6))){trap();}switch(x2){case 1:x8=mk(2,x3);x9=(x8+8);for(x10=0;x10<x3;x10++){MI[x9>>2]=(I)((MC[x4])==(MC[x7]));x9=(x9+4);x4=(x4+1);x7=(x7+1);}break;case 3:x8=mk(2,x3);x9=(x8+8);for(x10=0;x10<x3;x10++){MI[x9>>2]=(I)((MF[x4>>3])==(MF[x7>>3]));x9=(x9+4);x4=(x4+8);x7=(x7+8);}break;case 5:trap();break;case 6:trap();break;case 7:trap();break;default:x8=mk(2,x3);x9=(x8+8);for(x10=0;x10<x3;x10++){MI[x9>>2]=(I)((MI[x4>>2])==(MI[x7>>2]));x9=(x9+4);x4=(x4+4);x7=(x7+4);}}dx(x0);dx(x1);R x8;}
I mtc(I x0,I x1){I x2=0;x2=mk(2,1);MI[(x2+8)>>2]=(I)match(x0,x1);dx(x0);dx(x1);R x2;}
I match(I x0,I x1){I x2=0;I x3=0;I x4=0;I x5=0;I x6=0;I x7=0;I x8=0;if((x0==x1)){R 1;}if(!(((MI[x0>>2])==(MI[x1>>2])))){R 0;}x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);x5=(x1+8);x6=0;switch(x2){case 0:R 1;break;case 1:x7=x3;break;case 2:x7=(x3<<2);break;case 3:x7=(x3<<3);break;default:for(x8=0;x8<x3;x8++){if(!(match(MI[x4>>2],MI[x5>>2]))){R 0;}x4=(x4+4);x5=(x5+4);}R 1;}for(x8=0;x8<x7;x8++){if(!(((MC[(x4+x8)])==(MC[(x5+x8)])))){R 0;}}R 1;}
I fnd(I x0,I x1){I x2=0;I x3=0;I x4=0;I x5=0;I x6=0;I x7=0;I x8=0;I x9=0;I x10=0;I x11=0;x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);x5=((uI)(MI[x1>>2])>>(uI)29);x6=((MI[x1>>2])&536870911);x7=(8+x1);if(!((x2==x5))){trap();}x8=mk(2,x6);x9=(x8+8);x10=(I)MC[x5];for(x11=0;x11<x6;x11++){MI[x9>>2]=(I)fnx(x0,x7);x9=(x9+4);x7=(x7+x10);}dx(x0);dx(x1);R x8;}
I fnx(I x0,I x1){I x2=0;I x3=0;I x4=0;x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);switch(x2){case 0:trap();break;case 1:R fnc(x4,x3,(I)MC[x1]);break;case 2:R fni(x4,x3,MI[x1>>2]);break;case 3:R fnj(x4,x3,MJ[x1>>3]);break;case 6:trap();break;case 7:trap();break;default:R fnl(x4,x3,MI[x1>>2]);}R x0;}
I fnc(I x0,I x1,I x2){I x3=0;for(x3=0;x3<x1;x3++){if((((C)x2)==(MC[(x0+x3)]))){R x3;}}R x1;}
I fni(I x0,I x1,I x2){I x3=0;for(x3=0;x3<x1;x3++){if((x2==(MI[x0>>2]))){R x3;}x0=(x0+4);}R x1;}
I fnj(I x0,I x1,J x2){I x3=0;for(x3=0;x3<x1;x3++){if((x2==(MJ[x0>>3]))){R x3;}x0=(x0+8);}R x1;}
I fnl(I x0,I x1,I x2){I x3=0;for(x3=0;x3<x1;x3++){if(match(x2,MI[x0>>2])){R x3;}x0=(x0+4);}R x1;}
I exc(I x0,I x1){I x2=0;x2=mk(2,1);MI[(x2+8)>>2]=(I)((MI[x1>>2])&536870911);rx(x0);R atx(x0,wer(eql(x2,fnd(x1,x0))));}
I up(I x0,I x1){I x2=0;I x3=0;I x4=0;I x5=0;I x6=0;I x7=0;x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);while(((uI)x2<(uI)x1)){switch(x2){case 1:x5=mk(2,x3);x6=(8+x5);for(x7=0;x7<x3;x7++){MI[x6>>2]=(I)(I)MC[(x4+x7)];x6=(x6+4);}dx(x0);x0=x5;x2=2;break;case 2:x5=mk(3,x3);x6=(8+x5);for(x7=0;x7<x3;x7++){MF[x6>>3]=(F)(F)MI[x4>>2];x6=(x6+8);x4=(x4+4);}dx(x0);x0=x5;x2=3;break;case 3:R mkz(x0,mkf(0.0));break;default:trap();}}dx(x0);R x5;}
I srt(I x0){rx(x0);R atx(x0,grd(x0));}
I gdn(I x0){R rev(grd(x0));}
I grd(I x0){I x1=0;I x2=0;I x3=0;I x4=0;I x5=0;I x6=0;x1=((uI)(MI[x0>>2])>>(uI)29);x2=((MI[x0>>2])&536870911);x3=(8+x0);x4=seq(0,x2,1);x5=seq(0,x2,1);x6=(x4+8);msrt((x5+8),x6,0,x2,x3,x1);dx(x0);dx(x5);R x4;}
V msrt(I x0,I x1,I x2,I x3,I x4,I x5){I x6=0;if(((uI)((x3-x2))>=(uI)2)){x6=((uI)((x3+x2))/(uI)2);msrt(x1,x0,x2,x6,x4,x5);msrt(x1,x0,x6,x3,x4,x5);mrge(x0,x1,x2,x3,x6,x4,x5);};}
V mrge(I x0,I x1,I x2,I x3,I x4,I x5,I x6){I x7=0;I x8=0;I x9=0;I x10=0;I x11=0;I x12=0;x7=x2;x8=x4;x9=(I)MC[x6];x10=x2;while(((uI)x10<(uI)x3)){x11=((uI)x7>=(uI)x4);if(!x11){if(((uI)x8>=(uI)x3)){x11=0;}else{x11=((I(*)(I,I))MT[x6])((x5+((x9*(MI[(x0+((x7<<2)))>>2])))),(x5+((x9*(MI[(x0+((x8<<2)))>>2])))));}}if(x11){x12=x8;x8=(x8+1);}else{x12=x7;x7=(x7+1);}MI[(x1+((x10<<2)))>>2]=(I)MI[(x0+((x12<<2)))>>2];x10=(x10+1);};}
I gtc(I x0,I x1){R ((MC[x0])>(MC[x1]));}
I gti(I x0,I x1){R ((MI[x0>>2])>(MI[x1>>2]));}
I gtf(I x0,I x1){R ((MF[x0>>3])>(MF[x1>>3]));}
I gtl(I x0,I x1){I x2=0;I x3=0;I x4=0;I x5=0;I x6=0;I x7=0;I x8=0;I x9=0;I x10=0;I x11=0;I x12=0;x0=MI[x0>>2];x1=MI[x1>>2];x2=((uI)(MI[x0>>2])>>(uI)29);x3=((MI[x0>>2])&536870911);x4=(8+x0);x5=((uI)(MI[x1>>2])>>(uI)29);x6=((MI[x1>>2])&536870911);x7=(8+x1);if(!((x2==x5))){R ((uI)x2>(uI)x5);}x8=x3;if(((uI)x6<(uI)x3)){x8=x6;}x9=(I)MC[x2];for(x12=0;x12<x8;x12++){x10=(x4+((x12*x9)));x11=(x7+((x12*x9)));if(((I(*)(I,I))MT[x2])(x10,x11)){R 1;}if(((I(*)(I,I))MT[x2])(x11,x10)){R 0;}}R ((uI)x3>(uI)x6);}
V mt_init(){MT[1]=gtc;MT[2]=gti;MT[3]=gtf;MT[4]=gtl;MT[5]=gtl;}
// Postfix test interface: e.g. 5 mki til rev fst 0 500 dump
const trace = 0;
I pop1(I *s, I n, I *x) {
	*x = s[n-1];
	return n-1;
}
I pop2(I *s, I n, I *x, I *y) {
	*x = s[n-2];
	*y = s[n-1];
	return n-2;
}
I push(I *s, I n, I x) {
	s[n] = x;
	return n+1;
}
I f1(I (*f)(I), I *s, I n) {
	if(trace) printf("%d: ", s[n-1]);
	s[n-1] = f(s[n-1]);
	if(trace) printf("%d(%x)\n", s[n-1], s[n-1]);
	return n;
}
I f2(I (*f)(I,I), I *s, I n) {
	if(trace) printf("%d %d: ", s[n-2], s[n-1]);
	s[n-2] = f(s[n-2], s[n-1]);
	if(trace) printf("%d\n", s[n-2]);
	return n-1;
}
I Match(C *a, C *b) {
	for (I i=0; ;i++) {
		if (a[i] != b[i]) R 0;
		if (a[i] == 0)    R 1;
	}
}
V Dump(I x, I n) {
	I p = x>>2;
	printf("\n%08x  ", x);
	for (I i=0; i<n; i++) {
		printf(" %08x", MI[p+i]);
		if ((i > x) && ((i+1)%8 == 0))      printf("\n%08x  ", x+4*i+4);
		else if ((i > 0) && ((i+1)%4 == 0)) printf(" ");
	}
	printf("\n");
}
V kst(I x) {
	I i, j, y, m, tof;
	I t = ((uI)MI[x>>2])>>29;
	I n = ((uI)MI[x>>2])&536870911;
	switch(t){
	case 1:
		printf("\"");
		for(i=0;i<n;i++) printf("%c", MC[8+x+i]);
		printf("\"");
		break;
	case 2:
		x = 2 + (x>>2);
		for(i=0;i<n;i++) {
			if (i>0)  printf(" ");
			if (MI[x+i] == -2147483648) printf("0N");
			else                        printf("%d", MI[x+i]);
		}
		break;
	case 3:
		tof = 1;
		x = 1 + (x>>3);
		for(i=0;i<n;i++) {
			if (i>0)  printf(" ");
			if (MF[x+i] != MF[x+i]) { printf("0n"); tof = 0; } else printf("%g", MF[x+i]);
			if (MF[x+i] != (F)(I)MF[x+i]) tof = 0;
		}
		if(tof) printf("f");
		break;
	case 4:
		x = 2 + (x>>2);
		for(i=0;i<n;i++) {
			printf("%c", 96);
			y = MI[x+i];
			m = MI[y>>2]&536870911;
			for(j=0;j<m;j++) printf("%c", MC[8+y+j]);
		}
		break;
	case 5:
		x = 2 + (x>>2);
		printf("(");
		for(i=0;i<n;i++) {
			if(i>0) printf(";");
			kst(MI[x+i]);
		}
		printf(")");
		break;
	default:
		printf("nyi: kst %x t=%d\n", x, t);trap();
	}
}
V O(I x) { kst(x); printf("\n"); }
I parseNoun(C *s);
I findChr(C *s, I n, C p) {
	I i;
	for (i=0; i<n; i++) if (s[i] == p) return i;
	R n;
}
I chrVector(C *s) {
	I i, x;
	I n = strlen(s);
	s++; n-=2;
	if(n<0) trap();
	x = mk(1, n);
	for (i=0; i<n; i++) MC[8+x+i] = s[i];
	R x;
}
I lstVector(C *s) {
	I r[9];
	I l = 0;
	I a = 0;
	I rn = 0;
	I i;
	C p;
	I n = strlen(s);
	if ((n == 0) || s[n-1] != ')') { printf("parse list: %s\n", s); trap(); }
	if (n == 1) return mk(5, 0);
	s[n-1] = 0; n--;
	for (i=0; i<n; i++) {
		p = s[i];
		if (p=='(') l++;
		else if (p==')') {
			l--;
			if (l<0) { printf(")"); trap(); }
		} else if (l==0 && p == ';') {
			s[i] = 0;
			r[rn++] = parseNoun(s+a);
			if (r[rn-1] == 0) { printf("null element"); trap(); }
			a = i + 1;
			if (rn==8) { printf("list limit"); trap(); }
		}
	}
	r[rn++] = parseNoun(s+a);
	l = mk(5, rn);
	for (i=0;i<rn;i++) MI[2+(l>>2)+i] = r[i];
	R l;
}
I symVector(C *s) {
	I i, j, x, y, m;
	I n = strlen(s);
	I ns = 0;
	C *p;
	for (i=0;i<n;i++) if(s[i] == 96) ns++;
	x = mk(4, ns);
	s++;n--;
	for (i=0;i<ns;i++) {
		m = findChr(s, n, 96);
		y = mk(1, m);
		for (j=0;j<m;j++) MC[8+y+j] = s[j];
		MI[2+i+(x>>2)] = y;
		s += m+1; n -= m+1;
	}
	R x;
}
I numVector(C *s) {
	I n = strlen(s);
	I x, i;
	F fv[8];
	I iv[8];
	C *p;
	I isf = (strchr(s, '.') != NULL);
	if (s[0] == ',')      { s++;      n--; }
	if (n>0&&s[n-1]==',') { s[n-1]=0; n--; }
	p = strtok(s, ",");
	n = 0;
	while(p != NULL) {
		if (n==8) break;
		if (isf)  fv[n++] = atof(p);
		else      iv[n++] = atoi(p);
 		p = strtok(NULL, ",");
	}
	if (isf) {
		x = mk(3, n);
		for (i=0; i<n; i++) MF[i+1+(x>>3)] = fv[i];
	} else {
		x = mk(2, n);
		for (i=0; i<n; i++) MI[i+2+(x>>2)] = iv[i];
	}
	R x;
}
I parseNoun(C *s) {
	C c = s[0];
	if (c == '"')                return chrVector(s);
	if (c == 96)                 return symVector(s);
	if (c >= '0' && s[0] <= '9') return numVector(s);
	if (c == '(')                return lstVector(s+1);
	if (strchr(s, ',') != NULL)  return numVector(s);
	R 0;
}
#define M0 16
I main(int args, C **argv){
	mt_init();
	MC=malloc(1<<M0);MI=(I*)MC;MJ=(J*)MC;MF=(F*)MC;
	memset(MC, 0, 1<<M0);
	I stack[32];
	I i, n = 0;
	I x, y, r;
	C *a;
	ini(M0);
	for (i=1; i<args; i++) {
		a = argv[i];
		x = parseNoun(a);
		if (x != 0) {
			n = push(stack, n, x);
			continue;
		}
		//printf("%s ", argv[i]);
		if (Match("dump", a)) {
			Dump(0, 100);
		} else if (Match("bk", a)) { n = f2(bk, stack, n);
		} else if (Match("mk", a)) { n = f2(mk, stack, n);
		} else if (Match("mkd", a)) { n = f2(mkd, stack, n);
		} else if (Match("mkz", a)) { n = f2(mkz, stack, n);
		} else if (Match("til", a)) { n = f1(til, stack, n);
		} else if (Match("tir", a)) { n = f1(tir, stack, n);
		} else if (Match("atx", a)) { n = f2(atx, stack, n);
		} else if (Match("rev", a)) { n = f1(rev, stack, n);
		} else if (Match("fst", a)) { n = f1(fst, stack, n);
		} else if (Match("cut", a)) { n = f2(cut, stack, n);
		} else if (Match("drop", a)) { n = f2(drop, stack, n);
		} else if (Match("rsh", a)) { n = f2(rsh, stack, n);
		} else if (Match("prod", a)) { n = f2(prod, stack, n);
		} else if (Match("take", a)) { n = f2(take, stack, n);
		} else if (Match("cat", a)) { n = f2(cat, stack, n);
		} else if (Match("ucat", a)) { n = f2(ucat, stack, n);
		} else if (Match("lcat", a)) { n = f2(lcat, stack, n);
		} else if (Match("enl", a)) { n = f1(enl, stack, n);
		} else if (Match("cnt", a)) { n = f1(cnt, stack, n);
		} else if (Match("tip", a)) { n = f1(tip, stack, n);
		} else if (Match("wer", a)) { n = f1(wer, stack, n);
		} else if (Match("not", a)) { n = f1(not, stack, n);
		} else if (Match("eql", a)) { n = f2(eql, stack, n);
		} else if (Match("mtc", a)) { n = f2(mtc, stack, n);
		} else if (Match("match", a)) { n = f2(match, stack, n);
		} else if (Match("fnd", a)) { n = f2(fnd, stack, n);
		} else if (Match("fnx", a)) { n = f2(fnx, stack, n);
		} else if (Match("exc", a)) { n = f2(exc, stack, n);
		} else if (Match("up", a)) { n = f2(up, stack, n);
		} else if (Match("srt", a)) { n = f1(srt, stack, n);
		} else if (Match("gdn", a)) { n = f1(gdn, stack, n);
		} else if (Match("grd", a)) { n = f1(grd, stack, n);
		} else if (Match("gtc", a)) { n = f2(gtc, stack, n);
		} else if (Match("gti", a)) { n = f2(gti, stack, n);
		} else if (Match("gtf", a)) { n = f2(gtf, stack, n);
		} else if (Match("gtl", a)) { n = f2(gtl, stack, n);

		} else {
			printf("arg!");
			trap();
		}
	}
	if (n != 1) { printf("stack (%d)", n);trap(); }
	O(stack[0]);
}
