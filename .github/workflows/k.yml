name: ktye/k

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
   
    - name: checkout ktye/i
      uses: actions/checkout@v2
      with:
        path: i
   
    - name: checkout wg
      uses: actions/checkout@v2
      with:
        repository: ktye/wg
        path: wg
        
    - name: setup go
      uses: actions/setup-go@v2
      with:
        go-version: '1.17'
    
    - name: install wg
      run: cd wg && go install ./cmd/wg

    - name: build i
      run: cd i && go build -v ./
      
    - name: test i
      run: cd i && go test

    - name: build k.c
      run: | 
        cd i
        wg -c -prefix ktye_ . > k.c
        gcc -o kc -O2 k.c -lm
    
    - name: test k.c
      run: cd i && ./kc k.t -e
