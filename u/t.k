/k\ui terminal

ut:,," "                                            /text
(udw;udh;utx;uty;ucx;ucy):0 0 0 0 1 0               /display size, top-left text offset(line/col), cursor(line/col)
uvw:{{((ufw/udw)&#l)#l:utx_x}'((ufh/y)&#x)#uty_x}   /cut to viewport
ufg:{16777215*1-x};ubg:{x*15400959};utm:0           /colors(`?0x07rrggbb00), esc toggles utm(hold mode)
ufu:{(ufw\y)+x*ufw/y}                               /update font to udw 
ui:!0                                               /image(overlay)
up: {ucy::0|ucy;ucy::ucy&-1+#ut;ucx::0|ucx;ucx::ucx&#ut[ucy]                              /cursor text constraints
     h:udh-udw/#ui;uty::uty&ucy;uty::uty|1+ucy-ufh/h;utx::utx&ucx;utx::utx|1+ucx-ufw/udw  /scroll to view
     d:@[(udw*h)#ubg utm;,/,/{x+ufw*!#x}'(ufh*udw*!#t)+utf t:uvw[0+x;h];ufg utm]          /paint text
     c:ufu[udw;!(ufw*ufh)]+(ufw*ucx-utx)+ufh*udw*ucy-uty;d:@[d;c;16777215-]               /paint cursor
     ui,d}                                                                                /paint ui(top image) and terminal

/handlers
uk:{y;l:ut[ucy];
 $[x=13;$[utm;(ucx::0;ucy+::1;ut::?[ut;1+ucy;,""]);(ucx::1;ucy::-1+#ut;ut,::(`k@.:/:ut[ucy];," "))] /execute
   x=8;(ucx-::1;ut[ucy]::l[(#l)^0|-1+ucx])             /delete
   x=16;ucx::-1+_0%0;x=17;ucx::0                       /end,home
   x=18;ucx-::1;x=19;ucy-::1;x=20;ucx+::1;x=21;ucy+::1 /left,up,right,down
   x=27;$[#ui;ui::!0;utm::~utm]                        /close ui, toggle utm
   (ucx+::1;ut[ucy]::?[l;ucx;`c$x])]                   /insert
 up ut}
um: {x;y;!0}                                           /nyi select..
us: {(ui;udw;udh;utf)::(!0;x;y;ufu[x;uf]);up ut}       /(re)size	

ucm:{(65536*x)+(256*256-x)+64/(x-127)*x-128}[!256]     / colormap
umd:{d:1.5 2.5;c:|d-2*d*(!n)%0.+n:x;s:{(-/x*x;2*/x)};m:{+/x*x};ui::,/udw#'ucm@16*(!16)@+/(*\15#4)<\:n#m 10(c+s@)/0 0;} /e.g. umd 50 100

/font f2.k nyi:create replacements from 00..FF
ufs:{x:$[x=0;(`f0.k;10 20);x=1;(`f1.k;8 16);x=2;(`f2.k;10 20);x=3;(`f3.k;16 32)];. 1:*x;font;ufset[font;*|x];us[udw;udh];}
uf:!0;ufw:ufh:0;ufset:{(ufw;ufh)::y;fn:{&,/(8#2)\:'0+x}'x;c:"0123456789ABCDEF:+-*%&|<>=!~,^#_$?@.0123456789'/\\;`\"(){}[]abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";uf::256#,!0;uf[c+0]::fn[!#c];}
font:(0x00000180f066198660f018000000180f066198660f01800000 /00
 0x00000301c0300c0300c0780000000c0700c0300c0301e00000 /11
 0x00000381b00c060301807c0000001c0d806030180c03e00000 /22
 0x00000381b00c0600c1b0380000001c0d806030060d81c00000 /33
 0x000000c0703c1b07c0300c000000060381e0d83e0180600000 /44
 0x00000781e0401c0081e0780000001e07810070020781e00000 /55
 0x00000381b0601e06c1b0380000001c0d8300f0360d81c00000 /66
 0x00000781e00806030180600000001e078020180c0601800000 /77
 0x00000381b06c0e06c1b0380000001c0d836070360d81c00000 /88
 0x00000381b06c0f00c1b0380000001c0d836078060d81c00000 /99
 0x00000381b06c1f06c1b06c0000001c0d8360f8360d83600000 /AA
 0x00000701e06c1e06c1e070000000380f0360f0360f03800000 /BB
 0x00000381b060180601b0380000001c0d8300c0300d81c00000 /CC
 0x00000701e06c1b06c1e070000000380f0360d8360f03800000 /DD
 0x000007c180601e0601807c0000003e0c0300f0300c03e00000 /EE
 0x000007c180601e060180600000003e0c0300f0300c03000000 /FF
 0x00000000000007000070000000000000070000700000000000 /:
 0x00000000000003000030001fe0003000030000000000000000 /+
 0x00000000000000000000001fe0000000000000000000000000 /-
 0x0000000000000cc00078001fe00078000cc000000000000000 /*
 0x00000000c6001ec000d8000300006c000de0018c0000000000 /%
 0x00000000f00019800198000f00019e0018c000fe0000000000 /&
 0x00000000300003000030000300003000030000300000000000 /|
 0x00000000060001800060001800006000018000060000000000 /<
 0x00000001800006000018000060001800060001800000000000 />
 0x000000000000000001fe00000001fe00000000000000000000 /=
 0x00000000300003000030000300003000000000300000000000 /!
 0x00000000e6001b60019c000000000000000000000000000000 /~
 0x0000000000000000000000000000000007000060000c000000 /,
 0x000000003000078000cc001860000000000000000000000000 /^
 0x00000000d8000d8001fc000d8001fc000d8000d80000000000 /#
 0x00000000000000000000000000000000000001fe0000000000 /_
 0x0000000030000fc001b0000fc00036000fc000300000000000 /$
 0x00000000fc001860001c000300003000000000300000000000 /?
 0x00000000fc00186001be001ee001be00180000fc0000000000 /@
 0x00000000000000000000000000000000070000700000000000 /.
 0x0000000078000cc001860018600186000cc000780000000000 /0
 0x000000003000070000f0000300003000030000fc0000000000 /1
 0x00000000fc00186000060003c000e000180001fe0000000000 /2
 0x00000001fe0000c000180003c0000600186000fc0000000000 /3
 0x00000000180003800078000d8001fe00018000180000000000 /4
 0x00000001fe00180001fc001c60000600186000fc0000000000 /5
 0x000000007c000c000180001fc001c600186000fc0000000000 /6
 0x00000001fe000060000c000180003000060000600000000000 /7
 0x00000000fc0018600186000fc0018600186000fc0000000000 /8
 0x00000000fc001860018e000fe000060000c000f80000000000 /9
 0x00000000380003000060000000000000000000000000000000 /'
 0x00000000060000c000180003000060000c0001800000000000 //
 0x0000000180000c00006000030000180000c000060000000000 /\
 0x0000000000000700007000000000000007000060000c000000 /;
 0x00000000700003000018000000000000000000000000000000 /`
 0x00000000d8000d8000d8000000000000000000000000000000 /"
 0x00000000180003000060000600006000030000180000000000 /(
 0x00000000600003000018000180001800030000600000000000 /)
 0x000000001e00030000180007000018000300001e0000000000 /{
 0x00000001e00003000060000380006000030001e00000000000 /}
 0x000000007c00060000600006000060000600007c0000000000 /[
 0x00000000f80001800018000180001800018000f80000000000 /]
 0x000000000000000000fc00006000fe0018e000fe0000000000 /a
 0x000000018000180001fc001c600186001c6001fc0000000000 /b
 0x000000000000000000fc001860018000180000fe0000000000 /c
 0x000000000600006000fe0018e001860018e000fe0000000000 /d
 0x000000000000000000fc00186001fe00180000fc0000000000 /e
 0x000000003c0006600060001f80006000060000600000000000 /f
 0x000000000000000000fe0018c000f800180000fc00186000fc /g
 0x000000018000180001fc001c60018600186001860000000000 /h
 0x00000000300000000070000300003000030000fc0000000000 /i
 0x00000000060000000006000060000600006000c6000c60007c /j
 0x00000001800018000198001b0001e000198001860000000000 /k
 0x00000000700003000030000300003000030000780000000000 /l
 0x000000000000000001cc001fe001b6001b6001860000000000 /m
 0x000000000000000001fc001c60018600186001860000000000 /n
 0x000000000000000000fc001860018600186000fc0000000000 /o
 0x000000000000000001fc001c6001c6001fc001800018000180 /p
 0x000000000000000000fe0018e0018e000fe000060000600006 /q
 0x000000000000000001bc000e6000c0000c0000c00000000000 /r
 0x000000000000000000fc00180000fc00006001fc0000000000 /s
 0x000000006000060001f800060000600006c000380000000000 /t
 0x0000000000000000018c0018c0018c0018c000fe0000000000 /u
 0x0000000000000000018600186000cc00078000300000000000 /v
 0x0000000000000000018600186001b6001fe000cc0000000000 /w
 0x0000000000000000018c000d800070000d80018c0000000000 /x
 0x0000000000000000018c0018c0019c000fc0000c0018c000f8 /y
 0x000000000000000001fe0000c0003800060001fe0000000000 /z
 0x000000003000078000cc00186001fe00186001860000000000 /A
 0x00000001fc000c6000c6000fc000c6000c6001fc0000000000 /B
 0x000000007c000c6001800018000180000c60007c0000000000 /C
 0x00000001f8000cc000c6000c6000c6000cc001f80000000000 /D
 0x00000001fe0018000180001f80018000180001fe0000000000 /E
 0x00000001fe0018000180001f80018000180001800000000000 /F
 0x000000007c000c600180001800019e000c60007c0000000000 /G
 0x00000001860018600186001fe0018600186001860000000000 /H
 0x00000000fc0003000030000300003000030000fc0000000000 /I
 0x000000001e0000c0000c0000c0000c0018c000f80000000000 /J
 0x00000001860019c001f0001c0001f00019c001860000000000 /K
 0x00000001800018000180001800018000180001fe0000000000 /L
 0x0000000186001ce001fe001b60018600186001860000000000 /M
 0x0000000186001c6001e6001b60019e0018e001860000000000 /N
 0x00000000fc0018600186001860018600186000fc0000000000 /O
 0x00000001fc0018600186001fc0018000180001800000000000 /P
 0x00000000fc0018600186001860019e0018c000fe0000000000 /Q
 0x00000001fc0018600186001fc001980018c001860000000000 /R
 0x00000000fc0018600180000fc0000600186000fc0000000000 /S
 0x00000001fe0003000030000300003000030000300000000000 /T
 0x00000001860018600186001860018600186000fc0000000000 /U
 0x000000018600186000cc000cc0007800078000300000000000 /V
 0x00000001860018600186001b6001b6001fe000cc0000000000 /W
 0x0000000186000cc000780003000078000cc001860000000000 /X
 0x0000000186000cc00078000300003000030000300000000000 /Y
 0x00000001fe0000c000180003000060000c0001fe0000000000) /Z
ufset[font;10 20]