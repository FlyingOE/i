<!DOCTYPE html>
<head><meta charset="utf-8"><title>k+js</title></head>
<style>html,input,textarea{font-family:monospace;}</style>

<script type="module" src="k.js"></script>

<body>
<textarea readonly id="out" style="width:100%" rows=5 ></textarea>
<input type=text   id="in"  style="width:100%" placeholder="pitimes 1 2 3" /><br>
files:
<pre id="filelist"></pre>

<script type="module">
import {K} from './k.js'

function ge(x){return document.getElementById(x)}

let out=ge("out");
let inp=ge("in");
inp.onkeypress = function(ev){
 if(("Enter"==ev.key)&&(0<inp.value.length)){
  out.value += " " + inp.value + "\n"
  try{
   let x = K.Kx(inp.value)      
   if(x) out.value += K.CK(K.Kx("`k@", x)) + "\n"
   K.save()
  } catch(e) { K.restore() }
  inp.value = ""
  out.scrollTop = out.scrollHeight;
 }
}

let  ext = {}

ext.init = function(){ out.value = "k "+K.n+"\n" } //print when ready, n: k.wasm binary size

function us(s){return new TextEncoder("utf-8").encode(s)}

let files = {} // string(name)=>Uint8Array(data)

function listfiles(){ // list files written by k in a pre element with their size
 let s = ""
 let keys = Object.keys(files)
 for(let i=0;i<keys.length;i++) s += keys[i] + " " + String(files[keys[i]].length) + "\n"
 document.getElementById("filelist").textContent = s
}

// test read/write in k with:
//  `file<"abc"    /write
//  <`file         /read; should print "abc"

ext.read = function(name){ 
 var d=files[name]
 return (d===undefined) ? new Uint8Array(0) : d
}

ext.write= function(file,data){
 if(file=="") out.value += new TextDecoder("utf-8").decode(data)  // stdout
 else       { files[file] = data; listfiles() }
}


// pitimes is an extension function.
// it can be used from k: pitimes 1 2 3
ext.pitimes = function(x){ return K.Kx("*", K.Kf(Math.PI), K.Kx("*", x)) }

K.kinit(ext)


</script>

</body></html>
