set -e
set -x
rm -f out out.go in.go *.wasm


if [ -z "$1" ]; then
	for f in *.go; do
		go fmt $f
		k=`echo $f | sed 's/.go$/.k/'`
		wg -k $f > $k
	done
elif [ "$1" = go ]; then
	for x in *.k; do
		g=`echo $x | sed 's/.k$/.go/'`
		k $x ../go.k -e 'x:`<go``nort' > out.go
		go fmt out.go
		grep -v '^import' $g > in.go
		go fmt in.go
		cmp out.go in.go
		rm out.go in.go
	done
elif [ "$1" = wa ]; then
	for x in *.k; do
		w=`echo $x | sed 's/.k$/.wa/'`
		k $x ../wa.k -e 'x:`<wa``nort' > out
		cmp out $w
		rm out
	done
elif [ "$1" = i ];then
 	for x in *.k; do
		o=`echo $x | sed 's/.k$/.i/'`
	 	k $x ../ik.k -e 'x:`<ik``' > $o
	done
elif [ "$1" = walidate ]; then
	for x in *.wa; do
		/c/local/wabt/wat2wasm $x
	done
	rm *.wasm
else
	echo 1
fi


