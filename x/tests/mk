set -e
set -x
rm -f out_* in_*

if [ -z "$1" ]; then
	for f in *.go; do
		go fmt $f
		k=`echo $f | sed 's/.go$/.k/'`
		wg -k $f > $k
	done
elif [ "$1" = go ]; then
	for g in heap.go asn.go blank.go cal.go cast.go cli.go cnd.go const.go cont.go drp.go fun.go label.go lit.go loop.go loop2.go mem.go swtch.go tab.go; do
		k=`echo $g | sed 's/.go$/.k/'`
		k $k ../go.k -e 'x:`<emit go``nort' > out_$g
		go fmt out_$g
		grep -v '^import' $g > in_$g
		go fmt in_$g
		cmp out_$g in_$g
		rm out_$g in_$g
	done
else
	echo 1
fi
